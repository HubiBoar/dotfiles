x-base: &base
  image: devdocker/cde
  build: ./setup/docker
  network_mode: "host"
  environment:
    PROFILE: $PROFILE
  volumes: 
    - /home/dotfiles:/home/dotfiles
    - /home/projects:/home/projects
    - /home/dotfiles/dotfiles/.config/nvim/lua/profiles/${PROFILE}/plugins.lua:/dotfiles/.config/nvim/lua/plugins.lua
    - /home/dotfiles/dotfiles:/dotfiles
    - /home/dotfiles/devdocker/setup/state/${PROFILE}:/state
    - /home/dotfiles/devdocker/setup/state/${PROFILE}/tmux/plugins:/dotfiles/.config/tmux/plugins
    - /home/dotfiles/devdocker/setup/state/${PROFILE}/.local:/root/.local
    - /mnt/c:/mnt/c
    - /mnt/c/users/HUD/Desktop:/desktop
    - /var/run/docker.sock:/var/run/docker.sock
    - /root/.azure:/root/.azure
    - /root/.aspnet:/root/.aspnet
    - ./setup/startup:/startup
    - ./setup/.ssh:/root/.ssh
    - ./setup/.gitconfig:/root/.gitconfig

services:
  cde-base:
    <<: *base 
    container_name: cde-base
    profiles:
      - base
    command: sh -c "
        chmod +x /startup/**/*.sh
        && /startup/runner/config.sh
        && /startup/runner/run.sh
      "

  cde-nisportal:
    <<: *base 
    container_name: cde-nisportal
    profiles:
      - nisportal
    command: sh -c "
        chmod +x /startup/**/*.sh
        && /startup/runner/config.sh
        && /startup/modules/dotnet/dotnet.sh
        && /startup/modules/dotnet/azcli.sh
        && /startup/modules/node/node.sh
        && /startup/modules/node/node-yarn.sh
        && /startup/runner/run.sh
      "
  cde-dotnet:
    <<: *base 
    container_name: cde-dotnet
    profiles:
      - dotnet
    command: sh -c "
        chmod +x /startup/**/*.sh
        && /startup/runner/config.sh
        && /startup/modules/dotnet/dotnet.sh
        && /startup/modules/dotnet/azcli.sh
        && /startup/runner/run.sh
      "
